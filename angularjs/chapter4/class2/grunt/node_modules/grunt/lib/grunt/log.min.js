"use strict";var grunt=require("../grunt");var util=require("util");var log=module.exports={};var colors=require("colors");log.initColors=function(){var a=grunt.util;if(grunt.option("no-color")){colors.mode="none";a.hooker.hook(console,"log",function(){var b=a.toArray(arguments);return a.hooker.filter(this,b.map(function(c){return a.kindOf(c)==="string"?colors.stripColors(c):c}))})}};var suppressOutput;log.muted=false;var hasLogged;function markup(a){a=a||"";a=a.replace(/(\s|^)_(\S|\S[\s\S]+?\S)_(?=[\s,.!?]|$)/g,"$1"+"$2".underline);a=a.replace(/(\s|^)\*(\S|\S[\s\S]+?\S)\*(?=[\s,.!?]|$)/g,"$1"+"$2".bold);return a}function format(a){a=[].slice.call(a,0);if(a.length>0){a[0]=String(a[0])}return util.format.apply(util,a)}function write(a){a=a||"";if(!log.muted&&!suppressOutput){hasLogged=true;if(grunt.option("no-color")){a=colors.stripColors(a)}process.stdout.write(markup(a))}}function writeln(a){a=a||"";write(a+"\n")}log.write=function(){write(format(arguments));return log};log.writeln=function(){writeln(format(arguments));return log};log.warn=function(){var a=format(arguments);if(arguments.length>0){writeln(">> ".red+grunt.util._.trim(a).replace(/\n/g,"\n>> ".red))}else{writeln("ERROR".red)}return log};log.error=function(){grunt.fail.errorcount++;log.warn.apply(log,arguments);return log};log.ok=function(){var a=format(arguments);if(arguments.length>0){writeln(">> ".green+grunt.util._.trim(a).replace(/\n/g,"\n>> ".green))}else{writeln("OK".green)}return log};log.errorlns=function(){var a=format(arguments);log.error(log.wraptext(77,a));return log};log.oklns=function(){var a=format(arguments);log.ok(log.wraptext(77,a));return log};log.success=function(){var a=format(arguments);writeln(a.green);return log};log.fail=function(){var a=format(arguments);writeln(a.red);return log};log.header=function(){var a=format(arguments);if(hasLogged){writeln()}writeln(a.underline);return log};log.subhead=function(){var a=format(arguments);if(hasLogged){writeln()}writeln(a.bold);return log};log.debug=function(){var a=format(arguments);if(grunt.option("debug")){writeln("[D] "+a.magenta)}return log};log.writetableln=function(a,b){writeln(log.table(a,b));return log};log.writelns=function(){var a=format(arguments);writeln(log.wraptext(80,a));return log};log.writeflags=function(c,b){var a;if(Array.isArray(c)){a=log.wordlist(c)}else{if(typeof c==="object"&&c){a=log.wordlist(Object.keys(c).map(function(d){var e=c[d];return d+(e===true?"":"="+JSON.stringify(e))}))}}writeln((b||"Flags")+": "+(a||"(none)".cyan));return log};log.verbose={};log.notverbose={};Object.keys(log).filter(function(a){return typeof log[a]==="function"}).forEach(function(a){log.verbose[a]=function(){suppressOutput=!grunt.option("verbose");log[a].apply(log,arguments);suppressOutput=false;return log.verbose};log.notverbose[a]=function(){suppressOutput=grunt.option("verbose");log[a].apply(log,arguments);suppressOutput=false;return log.notverbose}});log.verbose.or=log.notverbose;log.notverbose.or=log.verbose;log.wordlist=function(a,b){b=grunt.util._.defaults(b||{},{separator:", ",color:"cyan"});return a.map(function(c){return b.color?String(c)[b.color]:c}).join(b.separator)};log.uncolor=function(a){return a.replace(/\x1B\[\d+m/g,"")};log.wraptext=function(e,h){var b=[];var g,c,d;var f=[];var a=0;while(g=h.match(/(?:(\x1B\[\d+m)|\n|(.))([\s\S]*)/)){h=g[3];if(g[1]){c=g[1];f.push(g[1]);continue}else{if(g[2]){if(a===0&&c){f.push(c)}f.push(g[2]);a++;if(a<=e||g[2]===" "){continue}d=f.lastIndexOf(" ");h=f.slice(d===-1?d:d+1).join("")+h;f=f.slice(0,d)}}b.push(f.join(""));f=[];a=0}b.push(f.join(""));return b.join("\n")};log.table=function(b,d){var c=[];b.forEach(function(g,f){var e=log.wraptext(g,d[f]).split("\n");e.forEach(function(h,i){var k=c[i];if(!k){k=c[i]=[]}k[f]=h})});var a=[];c.forEach(function(j){var e="";var g;for(var f=0;f<j.length;f++){g=j[f]||"";e+=g;var h=b[f]-log.uncolor(g).length;if(h>0){e+=grunt.util.repeat(h," ")}}a.push(e)});return a.join("\n")};