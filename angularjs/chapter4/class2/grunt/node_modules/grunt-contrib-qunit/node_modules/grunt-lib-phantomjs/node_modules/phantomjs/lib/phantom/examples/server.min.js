(function(){var e,c,f,a,g,d,b;f=require("webpage").create();g=require("webserver").create();d=require("system");e=void 0;a=void 0;if(d.args.length!==2){console.log("Usage: server.js <some port>");phantom.exit(1)}else{a=d.args[1];c=g.listen(a,function(i,h){console.log("GOT HTTP REQUEST");console.log(JSON.stringify(i,null,4));h.statusCode=200;h.headers={Cache:"no-cache","Content-Type":"text/html"};h.setHeader("foo","bar");h.write("<html><head><title>YES!</title></head>");h.write("<body><p>pretty cool :)</body></html>");return h.close()});if(!c){console.log("could not create web server listening on port "+a);phantom.exit()}b="http://localhost:"+a+"/foo/bar.php?asdf=true";console.log("SENDING REQUEST TO:");console.log(b);f.open(b,function(h){if(h!=="success"){console.log("FAIL to load the address")}else{console.log("GOT REPLY FROM SERVER:");console.log(f.content)}return phantom.exit()})}}).call(this);