(function(){var a,c,b;if(!Date.prototype.toISOString){Date.prototype.toISOString=function(){var d,e;e=function(f){if(f<10){return"0"+f}else{return f}};d=function(f){if(f<10){return"00"+f}else{if(f<100){return"0"+f}else{return f}}};return this.getFullYear()+"-"+e(this.getMonth()+1)+"-"+e(this.getDate())+"T"+e(this.getHours())+":"+e(this.getMinutes())+":"+e(this.getSeconds())+"."+d(this.getMilliseconds())+"Z"}}a=function(e,h,f,g){var d;d=[];g.forEach(function(k){var l,j,i;j=k.request;i=k.startReply;l=k.endReply;if(!j||!i||!l){return}return d.push({startedDateTime:j.time.toISOString(),time:l.time-j.time,request:{method:j.method,url:j.url,httpVersion:"HTTP/1.1",cookies:[],headers:j.headers,queryString:[],headersSize:-1,bodySize:-1},response:{status:l.status,statusText:l.statusText,httpVersion:"HTTP/1.1",cookies:[],headers:l.headers,redirectURL:"",headersSize:-1,bodySize:i.bodySize,content:{size:i.bodySize,mimeType:l.contentType}},cache:{},timings:{blocked:0,dns:-1,connect:-1,send:0,wait:i.time-j.time,receive:l.time-i.time,ssl:-1},pageref:e})});return{log:{version:"1.2",creator:{name:"PhantomJS",version:phantom.version.major+"."+phantom.version.minor+"."+phantom.version.patch},pages:[{startedDateTime:f.toISOString(),id:e,title:h,pageTimings:{onLoad:c.endTime-c.startTime}}],entries:d}}};c=require("webpage").create();b=require("system");if(b.args.length===1){console.log("Usage: netsniff.coffee <some URL>");phantom.exit(1)}else{c.address=b.args[1];c.resources=[];c.onLoadStarted=function(){return c.startTime=new Date()};c.onResourceRequested=function(d){return c.resources[d.id]={request:d,startReply:null,endReply:null}};c.onResourceReceived=function(d){if(d.stage==="start"){c.resources[d.id].startReply=d}if(d.stage==="end"){return c.resources[d.id].endReply=d}};c.open(c.address,function(d){var e;if(d!=="success"){console.log("FAIL to load the address");return phantom.exit(1)}else{c.endTime=new Date();c.title=c.evaluate(function(){return document.title});e=a(c.address,c.title,c.startTime,c.resources);console.log(JSON.stringify(e,void 0,4));return phantom.exit()}})}}).call(this);